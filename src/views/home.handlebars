<h1 class="mb-4">Productos</h1>

<div class="row">
  {{#each products}}
    <div class="col-md-4 mb-3">
      <div class="card">
        <img src="{{this.thumbnails.[0]}}" class="card-img-top" alt="{{this.title}}">
        <div class="card-body">
          <h5 class="card-title">{{this.title}}</h5>
          <p class="card-text">${{this.price}}</p>
          <button class="btn btn-primary add-to-cart" data-id="{{this._id}}">Agregar al carrito</button>
        </div>
      </div>
    </div>
  {{/each}}
</div>

<script>
const cartId = "{{cartId}}";

document.querySelectorAll(".add-to-cart").forEach(btn => {
  btn.addEventListener("click", async (e) => {
    const pid = e.target.dataset.id;
    try {
      await fetch(`/api/carts/${cartId}/product/${pid}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ quantity: 1 })
      });
      alert("Producto agregado al carrito");
    } catch (err) {
      console.error(err);
    }
  });
});
</script>
