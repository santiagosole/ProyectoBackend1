{{> header}}

<header>
  {{#if user}}
    <p>Bienvenido, {{user.name}} ({{user.role}})</p>
    <form action="/logout" method="POST" style="display:inline;">
      <button type="submit">Cerrar sesión</button>
    </form>
  {{else}}
    <a href="/login">Iniciar sesión</a> | 
    <a href="/register">Registrarse</a>
  {{/if}}
</header>

<h1>Productos</h1>

<div class="products-container" style="display:flex; flex-wrap: wrap; gap: 20px;">
  {{#each products}}
    <div class="product-card" style="border: 1px solid #ccc; padding: 10px; width: 200px;">
      <h3>{{this.title}}</h3>
      <img src="{{this.thumbnails.[0]}}" alt="{{this.title}}" width="150" style="display:block; margin-bottom: 10px;">
      <p>{{this.description}}</p>
      <p><strong>Precio: ${{this.price}}</strong></p>

      <!-- Form para agregar al carrito -->
      {{#if ../cartId}}
        <form action="/api/carts/{{../cartId}}/product/{{this._id}}" method="POST">
          <button type="submit">Agregar al carrito</button>
        </form>
      {{else}}
        <p>Error: carrito no disponible</p>
      {{/if}}
    </div>
  {{/each}}
</div>

<a href="/products/new">Agregar nuevo producto</a>
